# 更新日誌

## [Unreleased] - YYYY-MM-DD
### Added
- 將本地項目連接到 GitHub 倉庫 `https://github.com/nnimab/news`，並強制推送本地更改覆蓋遠程倉庫。
- 完全重寫 README.md，使其準確反映專案的實際功能和架構
  - 新增詳細的功能特點說明，包括核心功能和用戶體驗
  - 完整的技術架構說明（前端、後端、數據源）
  - 詳細的安裝和使用指南
  - 專案結構和配置說明
  - 開發指南和故障排除
  - 未來計劃和貢獻指南
### Fixed
- 修復不同頁面焦點新聞區塊 (`.now-trending`) 高度不一致的問題。為其添加了固定的 `height: 450px;`，使其不再受相鄰欄位內容高度影響。
- 修復部分頁面（local, tech, more）焦點新聞區塊圖片無法顯示的問題（因 `src="null"`）。修改加載流程，確保在顯示焦點新聞前為其獲取有效圖片URL。
- 修復國際 (`international.html`)、國內 (`local.html`) 和更多 (`more.html`) 頁面因數據類型錯誤導致的 `TypeError`，確保正確處理分類新聞物件。
- 修復科技頁面 (`tech.html`) 因數據類型錯誤導致的 `TypeError`，確保正確處理分類新聞物件。
- 修復 `displayNewsList` 函數因嘗試對物件使用 `forEach` 而導致的 TypeError。
- 修復首頁新聞無法顯示的問題，確保將正確分類的新聞數據傳遞給UI控制器。
- 修復分類頁面（科技、國內、國際、更多）中，右側焦點大圖新聞與左側列表新聞可能重複顯示同一條的問題。修改 `ui-controller.js` 相關邏輯，確保列表顯示的新聞從焦點新聞之後的條目開始。
- 修復科技頁面 (`tech.html`) 下方的「科技產品評測」和「創新科技趨勢」區塊新聞數量不足或空白的問題。修改 `ui-controller.js` 的 `init` 函數，增加科技頁面請求的新聞數量至 11 條，以滿足各區塊的顯示需求。
- 修復國內頁面 (`local.html`) 下方的「政治與社會」區塊新聞數量不足或空白的問題。修改 `ui-controller.js` 的 `init` 函數，增加國內頁面請求的新聞數量至 7 條，以滿足各區塊的顯示需求。
- 修復國際頁面 (`international.html`) 下方的「國際政治」和「全球經濟」區塊新聞數量不足或空白的問題。修改 `ui-controller.js` 的 `init` 函數，增加國際頁面請求的新聞數量至 11 條，以滿足各區塊的顯示需求。
- 增強 `news-fetcher.js` 中 `parseRSS` 函數的健壯性，以更好地處理不同結構的 RSS feed，特別是針對可能導致「全球經濟」區塊無新聞顯示的 `economy` feed。
    - 添加了對空 XML 內容和解析錯誤的檢查。
    - 嘗試了更多可能的標籤選擇器 (如 `entry` 代替 `item`, `published`/`updated` 代替 `pubDate`, `summary`/`content` 代替 `description`, `author > name` 代替 `source`)。
    - 改進了圖片 URL 的提取邏輯，嘗試多種常見模式。
    - 確保只有包含標題和連結的新聞項才會被添加。
### Changed
- 修改首頁「更多焦點新聞」區塊，使其顯示台灣 Yahoo News 的焦點新聞（頭條分類），而非國際新聞。
- 調整焦點新聞圖片 (`.featured-news-image`) 的 CSS 樣式，使其能夠完整填滿其容器 (`.trending-content`)，並使用 `object-fit: cover` 裁剪以適應不同長寬比，移除了下方多餘空白。
- 將所有頁面的左側和下方新聞列表（例如：科技新聞、國內消息、政治與社會、健康與生活等）顯示的新聞數量統一固定為 3 條，修改了 `ui-controller.js` 中的相關顯示函數。
- 修改焦點新聞區塊（大圖區塊）的點擊行為，移除點擊整個區塊導向連結的功能，現在只有點擊「閱讀」按鈕才會開啟新聞連結。修改了 `ui-controller.js` 中的 `displayFeaturedNews` 函數。
- 更新國際頁面 (`international.html`) 的新聞來源：
  - 新增 "AI" 和 "Economy" 兩個新聞分類，並使用對應的 Yahoo News RSS feed (`https://news.yahoo.com/rss/ai`, `https://news.yahoo.com/rss/economy`)。
  - 「國際政治」區塊現在顯示來自 "AI" feed 的新聞。
  - 「全球經濟」區塊現在顯示來自 "Economy" feed 的新聞。
  - 焦點新聞和「全球熱點」列表繼續使用原有的「國際」 feed。
  - 修改了 `news-fetcher.js` 和 `ui-controller.js`。
- 增加 `international.html` 頁面請求的新聞數量限制 (從 4 提高到 7)，以確保有足夠的 Economy 新聞填充「全球經濟」區塊。
- 提高 `tech.html`, `local.html`, `international.html` 頁面的圖片獲取數量限制 (從 5 提高到 15)，以改善圖片顯示不全的問題。

## 2025-04-27
- 優化新聞獲取和圖片載入機制
  - 重構新聞載入機制，根據頁面類型選擇性載入相關分類新聞
  - 分類頁面僅加載該頁面對應的新聞類別，顯著提高載入速度
  - 首頁(index.html)只加載科技、焦點、國內相關新聞
  - 各分類頁面(tech.html、local.html、international.html、more.html)只加載各自分類
  - 優化圖片載入策略，每個分類只加載前5張圖片，減少伺服器負載
  - 修改UI控制器，自動檢測當前頁面類型並適配合適的顯示區塊
  - 統一圖片載入邏輯，避免冗餘請求
  - 降低批次處理大小，從39減為10，降低伺服器負載並提高穩定性
  - 減少不必要的報錯提示，改善使用體驗

## 2025-04-26
- 增加分類頁面功能
  - 建立科技新聞專屬頁面(tech.html)，完整展示科技新聞與相關內容
  - 建立國內新聞專屬頁面(local.html)，劃分為政治與社會和財經新聞兩大區塊
  - 建立國際新聞專屬頁面(international.html)，包含國際政治和全球經濟區塊
  - 建立更多分類頁面(more.html)，涵蓋文化藝術、健康生活和體育新聞
  - 優化各分類頁面的導航結構，實現頁面間的相互跳轉
  - 每個頁面保持統一的設計風格，並根據分類特點調整內容布局

## 2025-04-18
- 初始化新聞聚合平台專案
- 根據影片串流的模板改造為新聞展示界面
- 新增骨架屏加載效果，提升用戶體驗
- 實現從Google News RSS feed獲取新聞數據
- 新聞自動分類為科技新聞、國內新聞和焦點新聞
- 為各新聞來源添加默認圖標
- 新聞點擊可跳轉到原始新聞來源閱讀
- 添加本地代理服務器示例，解決跨域問題
- 完善UI交互效果，優化用戶體驗
- 創建詳細文檔，包括README和開發計畫
- 添加package.json，方便依賴管理 

## 2025-04-19
- 修正焦點新聞標題顯示問題
- 優化閱讀按鈕樣式，移除emoji圖標
- 將閱讀按鈕改為白色背景，提升可讀性
- 修復背景圖片和用戶頭像無法顯示的問題
- 使用內嵌SVG代替外部圖片資源
- 優化本地代理服務器連接

## 2025-04-20
- 修正焦點新聞標題重複顯示問題
- 使用Imgur圖片替換原始新聞圖像，解決圖片加載失敗問題
- 暫時使用模擬數據模式，確保界面正常顯示
- 修復用戶體驗問題，提升界面穩定性
- 完全移除焦點新聞標題，優化界面簡潔度
- 將新聞來源改為Yahoo奇摩新聞統一RSS源 (https://tw.news.yahoo.com/rss/)
- 實現基於關鍵詞的新聞自動分類功能
- 優化RSS處理邏輯，減少重複請求
- 提高獲取新聞效率，一次獲取所有新聞並自動分類
- 修復JavaScript模塊導入/導出問題
- 更新HTML添加type="module"屬性支持ES模塊
- 重構UI控制器與新聞獲取模塊之間的連接
- 修復代理服務器相關問題，添加/fetchRSS接口支持
- 新增代理服務器狀態檢測和用戶提示

## 2025-04-21
- 修改新聞分類的RSS來源，每個分類使用對應的專門RSS源
- 從統一使用'https://tw.news.yahoo.com/rss/'改為使用各分類專門RSS源:
  - 政治: https://tw.news.yahoo.com/rss/politics
  - 財經: https://tw.news.yahoo.com/rss/finance
  - 國際: https://tw.news.yahoo.com/rss/world
  - 娛樂: https://tw.news.yahoo.com/rss/entertainment
  - 體育: https://tw.news.yahoo.com/rss/sports
  - 科技: https://tw.news.yahoo.com/rss/technology
  - 健康: https://tw.news.yahoo.com/rss/health
  - 生活: https://tw.news.yahoo.com/rss/lifestyle
- 重構新聞獲取機制，從單一RSS源獲取並自動分類改為從多個RSS源並行獲取
- 簡化categorizeNews函數，移除關鍵詞匹配邏輯，直接使用RSS源提供的分類

## 2025-04-22
- 修復分類新聞圖片顯示問題
- 改進parseRSS函數，增強對不同RSS源圖片格式的支持：
  - 新增對media:thumbnail標籤的支持
  - 添加對content:encoded內容的圖片提取
- 優化getNewsMetadata函數：
  - 增加超時時間從5秒到7秒，提高獲取成功率
  - 添加按分類顯示不同顏色和標題的預設圖片
  - 完善圖片獲取失敗時的降級處理
  - 增加詳細的日誌輸出，便於調試
- 重構processNewsInBatches函數：
  - 改為批次順序處理，避免同時發送過多請求
  - 減少批次大小至10，優化服務器負載
  - 添加批次處理進度日誌

## 2025-04-23
- 優化新聞獲取效率，限制每個分類的新聞數量
  - 修改fetchAllCategoryNews函數，添加數量限制參數，默認每個分類只獲取5條新聞
  - 更新fetchAndDisplayNews函數支持限制參數
  - 大幅減少加載和處理的新聞數量，從200+減少到約45條
  - 提高新聞加載速度，減少資源消耗
  - 降低伺服器負載，只處理實際需要顯示的新聞

## [0.3.2] - 2023-08-25
- 添加新聞圖片獲取功能
- 使用Open Graph協議獲取新聞縮略圖
- 實現不同新聞源的圖片提取和備用圖片機制
- 優化圖片加載速度，不阻塞初始新聞顯示 

## [0.3.3] - 2023-08-30
- 修復Google News重定向URL問題
- 實現URL重定向追蹤功能，正確獲取最終新聞來源
- 優化Open Graph圖片提取邏輯，提高準確性
- 使用並行批次處理提升圖片獲取效率
- 添加URL處理狀態追蹤，避免重複處理同一連結

## [0.3.4] - 2023-09-01
- 全面解決Google News URL解析問題
- 實現對Google News特殊編碼URL的Base64解碼提取
- 添加HTML頁面解析獲取真實新聞來源鏈接
- 增強無法獲取原始來源時的降級處理
- 提供基於新聞來源的智能預設圖像
- 添加標題和URL分析以提取可能的新聞來源
- 為常見台灣新聞媒體提供預設favicon

## [0.3.5] - 2023-09-02
- 徹底修復Google News JavaScript重定向URL提取問題
- 優化URL有效性驗證機制
- 增強從Google News URL中解析出實際新聞來源的能力
- 新增多層降級處理機制，確保即使無法獲取原始新聞也能顯示適當內容
- 自動從URL中識別台灣主要新聞媒體並提供相應圖像和favicon
- 為無法解析的URL提供更優質的預設顯示效果
- 使用更精確的正則表達式和更嚴謹的URL處理邏輯
- 改進媒體來源辨識和名稱格式化功能

## [0.3.6] - 2023-06-13
- 從Google News RSS切換到Yahoo 奇摩新聞RSS源，解決請求頻率限制問題
- 更新RSS解析邏輯以適應Yahoo奇摩新聞的格式
- 優化元數據提取，減少對第三方資源的依賴
- 標記開發計畫中"改用Yahoo奇摩新聞RSS源"為已完成

## 2024年5月11日
### 更新RSS源
- 已更新國際新聞RSS源為 https://news.yahoo.com/rss/world
- 移除了原先台灣地區的網址前綴，改為使用全球版國際新聞RSS

## 2025-04-24
- 優化UI顯示問題
  - 修改科技新聞標題的emoji圖標顏色為白色，提高可見度
  - 修復前端頁面中間最大塊的新聞版面顯示問題：
    - 增加最大高度至400px
    - 增強背景漸變深度提高文字可讀性
    - 添加信息區域滾動功能
    - 限制描述文字高度並設置行數限制
  - 移除除中間最大塊新聞版面外的其他區域（國內消息、更多焦點新聞）中的"閱讀"圓形按鈕
    - 簡化UI，提高整體美觀度
    - 減少視覺干擾元素 

## 2025-04-25
- 徹底修復焦點新聞圖片顯示不完全問題
  - 移除焦點新聞區域的最大高度限制
  - 增加焦點新聞內容區域高度至450px
  - 改進圖片顯示方式，設置object-position確保圖片居中且優先顯示上半部分
  - 優化背景漸變效果，使文字在圖片上更加清晰可讀
  - 限制描述文字長度，防止過長的描述破壞版面
  - 增強整體點擊體驗，點擊任意區域可打開新聞（除按鈕區域外）
  - 添加空值檢查，防止數據缺失導致顯示異常 

### [未發佈]

#### 修復
- 修正 `international.html` 頁面新聞分類顯示錯誤的問題，確保「國際政治」顯示 AI 新聞，「全球經濟」顯示 Economy 新聞，焦點和全球熱點顯示 World 新聞。

#### Changed
- 調整 `international.html` 頁面新聞分配邏輯：由於 AI 新聞源不穩定，「國際政治」和「全球經濟」區塊現在都使用 Economy 新聞源。前者顯示前 3 條，後者顯示第 4-7 條。
- 增加 `international.html` 頁面請求的新聞數量限制 (從 4 提高到 7)，以確保有足夠的 Economy 新聞填充「全球經濟」區塊。
- 提高 `tech.html`, `local.html`, `international.html` 頁面的圖片獲取數量限制 (從 5 提高到 15)，以改善圖片顯示不全的問題。 